# Настройка Always On для бота и веб-интерфейса

## Важная информация о Always On в Replit

Always On в Replit - это функция, которая позволяет приложению работать постоянно, даже когда вкладка браузера закрыта. Это платная функция, требующая Premium подписки или достаточного количества Cycles.

⚠️ **ВНИМАНИЕ! НОВАЯ СИСТЕМА ALWAYS ON** ⚠️

В проект добавлена новая, более надежная система Always On, специально разработанная для гарантированной работы в Replit. Она автоматически запускает и поддерживает все необходимые процессы.

## Инструкция по настройке Always On (НОВЫЙ МЕТОД)

1. **Деплой приложения**
   - Нажмите кнопку "Deploy" (Развернуть) в правом верхнем углу Replit
   - Выберите "Deploy to Replit"
   - Дождитесь завершения процесса деплоя

2. **Активация Always On**
   - После успешного деплоя, перейдите на страницу созданного деплоя
   - В настройках деплоя найдите опцию "Always On" и включите ее
   - Убедитесь, что индикатор Always On горит зеленым

3. **Проверка работоспособности (ОЧЕНЬ ВАЖНО!)**
   - После включения Always On, откройте страницу `/health` вашего приложения
   - Вы должны увидеть сообщение о том, что сервер работает
   - Теперь можно закрыть браузер - система продолжит работать
   - Через 5-10 минут откройте бота в Telegram и проверьте его работу

## Как работает новая система Always On

Новая система использует многоуровневый подход для обеспечения стабильной работы:

1. **Отказоустойчивая архитектура**
   - Основной сервер (`server.py`) отвечает за работу в режиме Always On
   - Вспомогательный сервис (`keep_alive.py`) управляет основными процессами
   - Каждый компонент работает независимо и может быть перезапущен при сбое

2. **Автоматическое восстановление**
   - Система мониторит состояние всех компонентов каждые несколько минут
   - При обнаружении сбоя происходит автоматический перезапуск
   - Все действия подробно логируются для диагностики

3. **Оптимизация для Replit**
   - Использован специальный подход, адаптированный под особенности платформы Replit
   - Процессы запускаются с корректными параметрами для стабильной работы
   - Поддерживается постоянная активность для предотвращения "засыпания" сервиса

## Проверка статуса системы

Для проверки работы системы используйте следующие URL:

- `/health` - проверка работоспособности основного сервера
- `/monitor` - страница мониторинга всех компонентов
- `/logs` - просмотр системных логов для диагностики проблем

## Устранение проблем

Если после настройки Always On система не работает при закрытом браузере:

1. **Проверьте активацию Always On**
   - Убедитесь, что индикатор Always On в настройках деплоя горит зеленым
   - Проверьте наличие достаточного количества Cycles для работы функции

2. **Проверьте логи**
   - Откройте страницу `/logs` вашего приложения
   - Изучите последние записи в логах `server_*.log` и `keep_alive_*.log`
   - Найдите возможные ошибки или предупреждения

3. **Перезапустите систему**
   - Выполните повторный деплой приложения
   - Снова активируйте функцию Always On
   - Проверьте работу бота после перезапуска

## Важные замечания

- Always On требует наличия Premium подписки Replit или достаточного количества Cycles
- Даже при включенном Always On, при длительной неактивности Replit может временно приостановить работу сервиса
- Для максимальной надежности рекомендуется настроить внешний сервис мониторинга (например, UptimeRobot) для периодического обращения к URL `/health`